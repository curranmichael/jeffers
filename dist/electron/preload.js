"use strict";var o=require("electron");var A="profile:get",u="bookmarks:import",k="file:saveTemp",s="bookmarks:progress",m="chat:stream:start",B="chat:stream:stop",i="chat:onResponseChunk",l="chat:onStreamEnd",a="chat:onStreamError",L="chat:getMessages",b="slices:getDetails",f="intent:set",S="intent:on-result",c="notebook:create",E="notebook:getById",_="notebook:getAll",g="notebook:update",T="notebook:delete",R="notebook:getChunks",d="chatSession:createInNotebook",O="chatSession:listForNotebook",p="chatSession:transferToNotebook",I="store:get",v="store:set",P="store:remove",h="main:request-renderer-flush",C="renderer:flush-complete",M="browser:create",x="browser:navigate",D="browser:loadUrl",$="classic-browser:set-bounds",w="classic-browser:set-visibility",N="browser:onState",H="browser:destroy";console.log("[Preload Script] Loading...");var K={getAppVersion:()=>(console.log("[Preload Script] Requesting app version via IPC"),o.ipcRenderer.invoke("get-app-version")),getProfile:()=>(console.log("[Preload Script] Requesting profile via IPC"),o.ipcRenderer.invoke(A)),importBookmarks:e=>(console.log("[Preload Script] Invoking bookmarks import via IPC"),o.ipcRenderer.invoke(u,e)),saveTempFile:(e,r)=>(console.log("[Preload Script] Invoking save temp file via IPC"),o.ipcRenderer.invoke(k,{fileName:e,data:r})),onBookmarksProgress:e=>{console.log("[Preload Script] Setting up listener for",s);let r=(t,n)=>{e(n)};return o.ipcRenderer.on(s,r),()=>{console.log("[Preload Script] Removing listener for",s),o.ipcRenderer.removeListener(s,r)}},startChatStream:e=>{let{notebookId:r,sessionId:t,question:n}=e;if(!r||!t||!n){console.error("[Preload Script] startChatStream called with invalid payload.",e);return}console.log(`[Preload Script] Sending CHAT_STREAM_START for notebook: ${r}, session: ${t}, question: "${n.substring(0,30)}..."`),o.ipcRenderer.send(m,e)},stopChatStream:()=>{console.log("[Preload Script] Sending CHAT_STREAM_STOP"),o.ipcRenderer.send(B)},onChatChunk:e=>{let r=(t,n)=>e(n);return o.ipcRenderer.on(i,r),()=>o.ipcRenderer.removeListener(i,r)},onChatStreamEnd:e=>{let r=(t,n)=>e(n);return o.ipcRenderer.on(l,r),()=>o.ipcRenderer.removeListener(l,r)},onChatStreamError:e=>{let r=(t,n)=>e(n);return o.ipcRenderer.on(a,r),()=>o.ipcRenderer.removeListener(a,r)},getMessages:(e,r,t)=>(console.log(`[Preload Script] Invoking getMessages for session: ${e}, limit: ${r}`),o.ipcRenderer.invoke(L,{sessionId:e,limit:r,beforeTimestamp:t})),getSliceDetails:e=>(console.log(`[Preload Script] Invoking getSliceDetails for ${e.length} IDs: [${e.slice(0,5).join(", ")}]...`),!Array.isArray(e)||e.some(r=>typeof r!="number")?(console.error("[Preload Script] getSliceDetails called with invalid input (must be array of numbers)."),Promise.reject(new Error("Invalid input: chunkIds must be an array of numbers."))):o.ipcRenderer.invoke(b,e)),setIntent:e=>(console.log("[Preload Script] Sending SET_INTENT with payload:",e.intentText.substring(0,50)+"..."),o.ipcRenderer.invoke(f,e)),onIntentResult:e=>{console.log("[Preload Script] Setting up listener for ON_INTENT_RESULT");let r=(t,n)=>{e(n)};return o.ipcRenderer.on(S,r),()=>{console.log("[Preload Script] Removing listener for ON_INTENT_RESULT"),o.ipcRenderer.removeListener(S,r)}},createNotebook:e=>(console.log(`[Preload Script] Invoking ${c}`),o.ipcRenderer.invoke(c,e)),getNotebookById:e=>(console.log(`[Preload Script] Invoking ${E} for ID: ${e}`),o.ipcRenderer.invoke(E,e)),getAllNotebooks:()=>(console.log(`[Preload Script] Invoking ${_}`),o.ipcRenderer.invoke(_)),updateNotebook:e=>(console.log(`[Preload Script] Invoking ${g} for ID: ${e.id}`),o.ipcRenderer.invoke(g,e)),deleteNotebook:e=>(console.log(`[Preload Script] Invoking ${T} for ID: ${e}`),o.ipcRenderer.invoke(T,e)),getChunksForNotebook:e=>(console.log(`[Preload Script] Invoking ${R} for notebook ID: ${e}`),o.ipcRenderer.invoke(R,e)),createChatInNotebook:e=>(console.log(`[Preload Script] Invoking ${d} for notebook ID: ${e.notebookId}`),o.ipcRenderer.invoke(d,e)),listChatsForNotebook:e=>(console.log(`[Preload Script] Invoking ${O} for notebook ID: ${e}`),o.ipcRenderer.invoke(O,e)),transferChatToNotebook:e=>(console.log(`[Preload Script] Invoking ${p} for session ID: ${e.sessionId}`),o.ipcRenderer.invoke(p,e)),storeGet:e=>(console.log(`[Preload Script] Invoking ${I} for key: ${e}`),o.ipcRenderer.invoke(I,e)),storeSet:(e,r)=>(console.log(`[Preload Script] Invoking ${v} for key: ${e}`),o.ipcRenderer.invoke(v,{key:e,value:r})),storeRemove:e=>(console.log(`[Preload Script] Invoking ${P} for key: ${e}`),o.ipcRenderer.invoke(P,e)),onMainRequestFlush:e=>{let r=async t=>{console.log("[Preload Script] Received MAIN_REQUEST_RENDERER_FLUSH");try{await e(),console.log("[Preload Script] Renderer flush callback completed. Sending RENDERER_FLUSH_COMPLETE."),o.ipcRenderer.send(C)}catch(n){console.error("[Preload Script] Error during renderer flush callback:",n),o.ipcRenderer.send(C)}};o.ipcRenderer.on(h,r)},classicBrowserCreate:(e,r,t)=>(console.log(`[Preload Script] Creating ClassicBrowser view ${e}`),o.ipcRenderer.invoke(M,{windowId:e,bounds:r,initialUrl:t})),classicBrowserLoadUrl:(e,r)=>(console.log(`[Preload Script] Invoking classicBrowserLoadUrl for window ${e}, url: ${r}`),o.ipcRenderer.invoke(D,{windowId:e,url:r})),classicBrowserNavigate:(e,r,t)=>(console.log(`[Preload Script] Invoking classicBrowserNavigate for window ${e}, action: ${r}, url: ${t}`),o.ipcRenderer.invoke(x,{windowId:e,action:r,url:t})),classicBrowserSetBounds:(e,r)=>o.ipcRenderer.invoke($,{windowId:e,bounds:r}),classicBrowserSetVisibility:(e,r)=>o.ipcRenderer.invoke(w,{windowId:e,isVisible:r}),classicBrowserDestroy:e=>(console.log(`[Preload Script] Destroying ClassicBrowser view ${e}`),o.ipcRenderer.invoke(H,{windowId:e})),onClassicBrowserState:e=>{console.log("[Preload Script] Setting up listener for ON_CLASSIC_BROWSER_STATE");let r=(t,n)=>{e(n)};return o.ipcRenderer.on(N,r),()=>{console.log("[Preload Script] Removing listener for ON_CLASSIC_BROWSER_STATE"),o.ipcRenderer.removeListener(N,r)}}};try{o.contextBridge.exposeInMainWorld("api",K),console.log("[Preload Script] API exposed successfully.")}catch(e){console.error("[Preload Script] Failed to expose API:",e)}
//# sourceMappingURL=preload.js.map
